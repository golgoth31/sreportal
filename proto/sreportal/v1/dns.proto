syntax = "proto3";

package sreportal.v1;

import "google/protobuf/timestamp.proto";

// DNSService provides DNS record management and discovery
service DNSService {
  // ListFQDNs returns all aggregated FQDNs from DNS resources
  rpc ListFQDNs(ListFQDNsRequest) returns (ListFQDNsResponse);

  // StreamFQDNs streams FQDN updates in real-time
  rpc StreamFQDNs(StreamFQDNsRequest) returns (stream StreamFQDNsResponse);
}

// ListFQDNsRequest is the request for listing FQDNs
message ListFQDNsRequest {
  // namespace filters FQDNs by namespace (empty for all namespaces)
  string namespace = 1;

  // source filters FQDNs by source (empty for all sources)
  string source = 2;

  // search filters FQDNs by name substring
  string search = 3;

  // portal filters FQDNs by portal name (empty for all portals)
  string portal = 4;

  // page_size limits the number of FQDNs returned. 0 means return all (default, backward-compatible).
  int32 page_size = 5;

  // page_token is an opaque cursor returned by a previous ListFQDNs call.
  // Empty string means start from the beginning.
  string page_token = 6;
}

// ListFQDNsResponse contains the list of FQDNs
message ListFQDNsResponse {
  // fqdns is the list of aggregated FQDNs
  repeated FQDN fqdns = 1;

  // next_page_token is the cursor to use in the next ListFQDNs call to retrieve the next page.
  // Empty when there are no more results.
  string next_page_token = 2;

  // total_size is the total number of FQDNs matching the request filters, before pagination.
  int32 total_size = 3;
}

// StreamFQDNsRequest is the request for streaming FQDN updates
message StreamFQDNsRequest {
  // namespace filters updates by namespace (empty for all namespaces)
  string namespace = 1;

  // portal filters updates by portal name (empty for all portals)
  string portal = 2;

  // source filters updates by source (empty for all sources)
  string source = 3;

  // search filters updates by FQDN name substring (empty for all)
  string search = 4;
}

// StreamFQDNsResponse represents an update to an FQDN
message StreamFQDNsResponse {
  // type is the type of update
  UpdateType type = 1;

  // fqdn is the FQDN that was updated
  FQDN fqdn = 2;
}

// UpdateType represents the type of update
enum UpdateType {
  UPDATE_TYPE_UNSPECIFIED = 0;
  UPDATE_TYPE_ADDED = 1;
  UPDATE_TYPE_MODIFIED = 2;
  UPDATE_TYPE_DELETED = 3;
}

// OriginResourceRef identifies the Kubernetes resource that produced an FQDN.
// Only populated for FQDNs discovered via external-dns sources.
message OriginResourceRef {
  // kind is the Kubernetes resource kind (e.g. Service, Ingress, DNSEndpoint)
  string kind = 1;

  // namespace is the Kubernetes namespace of the origin resource
  string namespace = 2;

  // name is the name of the origin Kubernetes resource
  string name = 3;
}

// FQDN represents a fully qualified domain name with metadata
message FQDN {
  // name is the fully qualified domain name
  string name = 1;

  // source indicates where this FQDN came from (manual or external-dns)
  string source = 2;

  // groups is the list of groups this FQDN belongs to
  repeated string groups = 3;

  // description is an optional human-readable description
  string description = 4;

  // record_type is the DNS record type (A, AAAA, CNAME, etc.)
  string record_type = 5;

  // targets is the list of target addresses for this FQDN
  repeated string targets = 6;

  // last_seen is the timestamp when this FQDN was last observed
  google.protobuf.Timestamp last_seen = 7;

  // dns_resource_name is the name of the DNS resource this FQDN belongs to
  string dns_resource_name = 8;

  // dns_resource_namespace is the namespace of the DNS resource
  string dns_resource_namespace = 9;

  // origin_ref identifies the Kubernetes resource (Service, Ingress, DNSEndpoint)
  // that produced this FQDN via external-dns. Not set for manual entries.
  optional OriginResourceRef origin_ref = 10;

  // sync_status indicates whether the FQDN is correctly resolved in DNS.
  // Values: "sync", "notavailable", "notsync", or empty.
  string sync_status = 11;
}
